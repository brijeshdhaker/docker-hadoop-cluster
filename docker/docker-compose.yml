# docker-compose build
# docker-compose up -d
# docker-compose scale nodemanager=X; # X=integer number --> allows to add more nodes to the hadoop cluster for testing

version: '3'
services:
  mongo:
    image: mongo:latest
    hostname: mongo
    container_name: mongo
    restart: always
#    environment:
#      MONGO_INITDB_ROOT_USERNAME: mongoadmin
#      MONGO_INITDB_ROOT_PASSWORD: secret
    ports:
      - 27017:27017
#    volumes:
#      - /e/apps/hostpath/mongo:/data/db

#      
  namenode:
    image: hadoop:2.7.2
    container_name: namenode
    ports: 
      - "50070:50070"
      - "9000:9000"
    command: /usr/local/bin/start-namenode.sh
    hostname: namenode
    volumes:
      - /e/apps/hostpath/hadoop/data:/data
#        
  datanode:
    image: hadoop:2.7.2
    command: hdfs datanode
    ports:
      - "50075" # local port dynamically assigned. allows node to be scaled up and down
      - "50010:50010"
    links:
      - namenode
    hostname: datanode
    volumes:
      - /e/apps/hostpath/hadoop/data:/data
#          
  secondarynamenode:
    image: hadoop:2.7.2
    container_name: secondarynamenode
    command: hdfs secondarynamenode
    ports:
      - "50090:50090"
    links:
      - namenode
    hostname: secondarynamenode
#    
  yarn:
    image: hadoop:2.7.2
    container_name: yarn
    command: start-yarn-historyserver.sh
    ports:
      - "8088:8088"
      - "8042:8042"
      - "8050:8050"
      - "19888:19888"
      - "10020:10020"
    links:
      - namenode
      - datanode
    hostname: yarn
#    
  nodemanager:
    image: hadoop:2.7.2
    command: yarn nodemanager
    ports:
      - "8042" # local port dynamically assigned. allows node to be scaled up and down
    links:
      - namenode
      - datanode
      - yarn
#          
  hadoop-cluster-example:
    image: hadoop-cluster-example:latest
    container_name: hadoop-cluster-example
    links:
      - mongo
      - yarn 
      - namenode
